# Java 17 环境变量配置脚本
# 需要以管理员权限运行 PowerShell

$javaHome = "C:\Program Files\Eclipse Adoptium\jdk-17.0.17.10-hotspot"
$javaBin = "$javaHome\bin"

Write-Host "正在配置 Java 17 环境变量..." -ForegroundColor Cyan
Write-Host "Java 路径: $javaHome" -ForegroundColor Yellow
Write-Host ""

# 检查路径是否存在
if (-not (Test-Path $javaHome)) {
    Write-Host "错误: Java 17 安装路径不存在！" -ForegroundColor Red
    exit 1
}

# 检查是否以管理员权限运行
$isAdmin = ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)
if (-not $isAdmin) {
    Write-Host "警告: 需要管理员权限来修改系统环境变量" -ForegroundColor Yellow
    Write-Host "请右键点击 PowerShell，选择'以管理员身份运行'，然后重新执行此脚本" -ForegroundColor Yellow
    Write-Host ""
    Write-Host "或者手动配置:" -ForegroundColor Cyan
    Write-Host "1. 右键'此电脑' -> 属性 -> 高级系统设置 -> 环境变量" -ForegroundColor White
    Write-Host "2. 在'系统变量'中新建或编辑 JAVA_HOME = $javaHome" -ForegroundColor White
    Write-Host "3. 在'系统变量'的 Path 中添加: %JAVA_HOME%\bin" -ForegroundColor White
    exit 1
}

# 设置 JAVA_HOME
try {
    [Environment]::SetEnvironmentVariable("JAVA_HOME", $javaHome, "Machine")
    Write-Host "✓ 已设置 JAVA_HOME = $javaHome" -ForegroundColor Green
} catch {
    Write-Host "✗ 设置 JAVA_HOME 失败: $_" -ForegroundColor Red
}

# 添加到 PATH
try {
    $currentPath = [Environment]::GetEnvironmentVariable("Path", "Machine")
    
    if ($currentPath -notlike "*$javaBin*") {
        # 将 Java bin 添加到 PATH 的最前面（优先级更高）
        $newPath = "$javaBin;$currentPath"
        [Environment]::SetEnvironmentVariable("Path", $newPath, "Machine")
        Write-Host "✓ 已添加 $javaBin 到 PATH（最前面）" -ForegroundColor Green
    } else {
        Write-Host "✓ $javaBin 已在 PATH 中" -ForegroundColor Yellow
    }
} catch {
    Write-Host "✗ 设置 PATH 失败: $_" -ForegroundColor Red
}

Write-Host ""
Write-Host "配置完成！" -ForegroundColor Green
Write-Host ""
Write-Host "请执行以下步骤:" -ForegroundColor Cyan
Write-Host "1. 关闭当前 PowerShell 窗口" -ForegroundColor White
Write-Host "2. 重新打开 PowerShell（以普通用户身份）" -ForegroundColor White
Write-Host "3. 运行: java -version" -ForegroundColor White
Write-Host "4. 应该显示 Java 17" -ForegroundColor White
Write-Host ""

